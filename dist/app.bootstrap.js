"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.vectorServer = exports.MailServer = exports.redisServer = exports.dbServer = exports.server = exports.boot = void 0;
const environment_config_js_1 = require("./config/environment.config.js");
const app_config_js_1 = require("./config/app.config.js");
const logger_service_js_1 = require("./services/logger.service.js");
const db_server_js_1 = require("./servers/db.server.js");
const redis_server_js_1 = require("./servers/redis.server.js");
const http_server_js_1 = require("./servers/http.server.js");
const vector_server_js_1 = require("./servers/vector.server.js");
const mail_service_js_1 = require("./services/mail.service.js");
const logger = logger_service_js_1.Logger.getInstance();
logger.log('debug', 'Starting server...', { label: 'Server' });
const dbServer = db_server_js_1.DatabaseServer.getInstance();
const redisServer = new redis_server_js_1.RedisServer();
const mailServer = new mail_service_js_1.MailService();
let wrappedVectorServerForTesting;
if (environment_config_js_1.env !== 'ci') {
    const vectorServer = new vector_server_js_1.VectorServer();
    vectorServer.start();
    exports.vectorServer = wrappedVectorServerForTesting = vectorServer;
}
dbServer.start();
redisServer.start();
mailServer.setup();
const application = new app_config_js_1.Application();
const httpServer = new http_server_js_1.HTTPServer(application.app);
httpServer.start();
const wrappedServerForTesting = httpServer;
exports.boot = wrappedServerForTesting;
const wrappedHttpForTesting = httpServer.http;
exports.server = wrappedHttpForTesting;
const wrappedSQLServerForTesting = dbServer;
exports.dbServer = wrappedSQLServerForTesting;
const wrappedRedisServerForTesting = redisServer;
exports.redisServer = wrappedRedisServerForTesting;
const wrappedMailServerForTesting = mailServer;
exports.MailServer = wrappedMailServerForTesting;
